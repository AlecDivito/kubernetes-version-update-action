name: Kubernetes Version Update Action
description:
  Automatically updates application versions in YAML files and creates PRs with
  AI risk analysis.
author: alecdivito

branding:
  icon: refresh-cw
  color: green

inputs:
  github_token:
    description: GitHub token for API requests and git operations.
    required: true
    default: ${{ github.token }}
  repo:
    description:
      Repository where the application source or image is located (e.g.,
      owner/repo).
    required: true
  type:
    description: Type of update (kubernetes, helm, or manual).
    required: true
    default: kubernetes
  source:
    description: Source of version information (github or dockerhub).
    required: true
    default: github
  targets:
    description:
      'JSON array of target files and paths to update (e.g., ''[{"file":
      "deploy.yaml", "path": "image"}]'').'
    required: false
    type: string
  version:
    description: The current version of the application (for manual type).
    required: false
    type: string
  description:
    description: Context about the application for AI analysis.
    required: false
    type: string
  release_filter:
    description: Optional filter for releases (e.g., a prefix or substring).
    required: false
    type: string
  openai_base_url:
    description: Base URL for OpenAI API.
    required: false
    type: string
  openai_model:
    description: Model name for OpenAI API.
    required: false
    type: string
  openai_api_key:
    description: API key for OpenAI.
    required: false
    type: string
  openai_max_note_length:
    description:
      Maximum length of release notes before chunking for AI analysis.
    required: false
    default: '15000'
  max_releases:
    description: Maximum number of releases to analyze.
    required: false
    default: 'Infinity'
  dry_run:
    description:
      If true, only log changes and do not perform git operations or PR
      creation.
    required: false
    default: 'false'
  git_user_name:
    description: Name of the git user for commits.
    required: false
    default: 'github-actions[bot]'
  git_user_email:
    description: Email of the git user for commits.
    required: false
    default: 'github-actions[bot]@users.noreply.github.com'
  config_file:
    description: Path to the configuration file.
    required: false
    default: 'versions-config.yaml'
  include_prereleases:
    description: Whether to include prerelease versions in updates.
    required: false
    default: 'false'
  version_lag:
    description:
      Number of versions to lag behind (e.g., 1 means stay on the previous
      version).
    required: false
    default: '0'
  version_lag_depth:
    description:
      The depth of versioning to apply the lag to (major, minor, or patch).
      Default is minor.
    required: false
    default: 'minor'

runs:
  using: node24
  main: dist/index.js
